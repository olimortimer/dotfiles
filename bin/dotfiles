#!/bin/bash

function e_header()   { echo -e "\n\033[1m$@\033[0m"; }
function e_success()  { echo " [✔] $@"; }
function e_error()    { echo " [✖] $@"; }
function e_process()    { echo " [•] $@"; }



e_header "Dotfiles"
#Update or download the dotfiles repo
if [ -d ~/.dotfiles ]; then
    e_process 'Updating dotfiles'
    #cd ~/.dotfiles
    #git pull
else
    e_process 'Downloading dotfiles'
    #mkdir -p ~/.dotfiles
    #cd ~/.dotfiles
    #git clone 
fi





#Run our processes for installing
function process(){
    #required settings to detect files properly in the process function
    shopt -s dotglob
    shopt -s nullglob
    
    local files=(~/.dotfiles/$1/*)
    for file in ${files[@]}; do
       [[ $(declare -f "$1_process") ]] && "$1_process" "$file"
     done
}


function install_process(){
    source "$1"
}


function link_process(){
    local base="$(basename $1)"
    local dest="$HOME/$base"
    if [[ "$1" -ef "$dest" ]]; then
        e_process "Skipping ${base} linking. Link already exists"
    else
        e_success "Linking ${base}"
        ln -sf "${1#$HOME/}" ~/
    fi
}



process "install"

e_header "Linking dot files"
process "link"


shopt -s expand_aliases
source ~/.bashrc
e_header "Completed"



# Ask for the administrator password upfront
#sudo -v

# Keep-alive: update existing `sudo` time stamp until `.osx` has finished
#while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &